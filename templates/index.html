<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AltitudeAI ‚Äî Industrial Intelligence Platform</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --red: #EE1B24;
            --red-dark: #B11016;
            --slate: #1D1D1D;
            --white: #FFFFFF;
            --gray-1: #262626;
            --gray-2: #404040;
            --gray-3: #7F7F7F;
            --gray-4: #C4C4C4;
            --gray-5: #F0F0F0;
            --success: #10b981;
            --warning: #f59e0b;
            --info: #3b82f6;
            --purple: #7c3aed;
            --bg: #F5F5F5;
            --card: #FFFFFF;
            --border: #E0E0E0;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--bg);
            color: var(--slate);
            line-height: 1.6;
        }

        /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
        .header {
            background: var(--white);
            border-bottom: 2px solid var(--border);
            padding: 0 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .header-inner {
            max-width: 1440px;
            margin: 0 auto;
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-mark {
            width: 36px;
            height: 36px;
            background: var(--red);
            border-radius: 8px;
            display: grid;
            place-items: center;
        }

        .logo-mark svg { width: 20px; height: 20px; }

        .logo-name {
            font-size: 1.4rem;
            font-weight: 700;
            letter-spacing: -0.5px;
            color: var(--slate);
        }

        .logo-name span { color: var(--red); }

        .logo-pill {
            background: linear-gradient(135deg, var(--purple), var(--info));
            color: white;
            font-size: 0.65rem;
            font-weight: 700;
            padding: 2px 8px;
            border-radius: 20px;
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }

        .nav { display: flex; gap: 1.75rem; }
        .nav a {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--gray-2);
            text-decoration: none;
            transition: color 0.15s;
        }
        .nav a:hover { color: var(--red); }

        /* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
        .container {
            max-width: 1440px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* ‚îÄ‚îÄ AI SEARCH HERO ‚îÄ‚îÄ */
        .search-hero {
            background: linear-gradient(135deg, var(--slate) 0%, #2d2d2d 100%);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
        }

        .search-hero::before {
            content: '';
            position: absolute;
            top: -40px; right: -40px;
            width: 200px; height: 200px;
            background: rgba(238, 27, 36, 0.08);
            border-radius: 50%;
        }

        .search-hero-label {
            font-size: 0.75rem;
            font-weight: 600;
            color: rgba(255,255,255,0.5);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .search-hero-label::before {
            content: '';
            display: inline-block;
            width: 6px; height: 6px;
            background: var(--success);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .search-row {
            display: flex;
            gap: 0.75rem;
        }

        .ai-input {
            flex: 1;
            padding: 0.875rem 1.25rem;
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 10px;
            color: white;
            font-size: 0.9rem;
            font-family: 'Poppins', sans-serif;
            transition: border-color 0.2s;
        }

        .ai-input:focus {
            outline: none;
            border-color: rgba(238, 27, 36, 0.6);
            background: rgba(255,255,255,0.12);
        }

        .ai-input::placeholder { color: rgba(255,255,255,0.35); }

        .ai-btn {
            padding: 0.875rem 1.75rem;
            background: var(--red);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            font-size: 0.875rem;
            font-family: 'Poppins', sans-serif;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
            transition: background 0.15s, transform 0.1s;
        }

        .ai-btn:hover { background: var(--red-dark); transform: translateY(-1px); }
        .ai-btn:active { transform: translateY(0); }

        .search-hints {
            margin-top: 0.75rem;
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .hint-chip {
            padding: 4px 12px;
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.12);
            border-radius: 20px;
            font-size: 0.75rem;
            color: rgba(255,255,255,0.55);
            cursor: pointer;
            transition: all 0.15s;
        }

        .hint-chip:hover {
            background: rgba(255,255,255,0.14);
            color: rgba(255,255,255,0.85);
        }

        /* ‚îÄ‚îÄ AI STATUS BANNER ‚îÄ‚îÄ */
        .ai-status {
            display: none;
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 10px;
            padding: 0.75rem 1.25rem;
            margin-bottom: 1.5rem;
            font-size: 0.875rem;
            color: #856404;
            align-items: center;
            gap: 10px;
        }

        .ai-status.visible { display: flex; }

        /* ‚îÄ‚îÄ STATS ‚îÄ‚îÄ */
        .stats-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            background: var(--card);
            border-radius: 12px;
            padding: 1.25rem 1.5rem;
            border-left: 4px solid var(--red);
            box-shadow: 0 1px 4px rgba(0,0,0,0.06);
        }

        .stat-card.green  { border-left-color: var(--success); }
        .stat-card.purple { border-left-color: var(--purple); }
        .stat-card.amber  { border-left-color: var(--warning); }

        .stat-label {
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--gray-3);
            margin-bottom: 4px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--slate);
            line-height: 1;
        }

        /* ‚îÄ‚îÄ AI INSIGHTS ‚îÄ‚îÄ */
        .insights-section {
            background: var(--card);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 1px 4px rgba(0,0,0,0.06);
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 1.25rem;
        }

        .section-title {
            font-size: 1rem;
            font-weight: 700;
            color: var(--slate);
        }

        .section-badge {
            font-size: 0.7rem;
            font-weight: 700;
            padding: 2px 8px;
            border-radius: 20px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .badge-purple { background: #ede9fe; color: var(--purple); }
        .badge-green  { background: #d1fae5; color: #065f46; }

        .insights-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.875rem;
        }

        .insight-card {
            padding: 1rem;
            background: var(--gray-5);
            border-radius: 10px;
            border-left: 3px solid var(--purple);
        }

        .insight-type {
            font-size: 0.65rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--purple);
            margin-bottom: 4px;
        }

        .insight-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--slate);
            margin-bottom: 4px;
        }

        .insight-desc {
            font-size: 0.8rem;
            color: var(--gray-2);
            line-height: 1.5;
        }

        .insight-confidence {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-top: 8px;
            font-size: 0.72rem;
            color: var(--success);
            font-weight: 600;
        }

        /* ‚îÄ‚îÄ FILTERS ‚îÄ‚îÄ */
        .filters-section {
            background: var(--card);
            border-radius: 12px;
            padding: 1.25rem 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 1px 4px rgba(0,0,0,0.06);
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1rem;
            align-items: end;
        }

        .filter-group { display: flex; flex-direction: column; gap: 5px; }

        .filter-label {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--gray-2);
        }

        .filter-select {
            padding: 0.625rem 0.75rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 0.8rem;
            font-family: 'Poppins', sans-serif;
            background: white;
            color: var(--slate);
            cursor: pointer;
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--red);
            box-shadow: 0 0 0 2px rgba(238, 27, 36, 0.1);
        }

        .filter-btn {
            padding: 0.625rem 1.25rem;
            background: var(--red);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.8rem;
            font-family: 'Poppins', sans-serif;
            cursor: pointer;
            transition: background 0.15s;
        }

        .filter-btn:hover { background: var(--red-dark); }

        /* ‚îÄ‚îÄ RESULTS ‚îÄ‚îÄ */
        .results-section {
            background: var(--card);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 1px 4px rgba(0,0,0,0.06);
        }

        .results-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .results-title { font-size: 1rem; font-weight: 700; }
        .results-meta { font-size: 0.8rem; color: var(--gray-3); }

        /* ‚îÄ‚îÄ COMPANY CARD ‚îÄ‚îÄ */
        .company-card {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
            transition: background 0.15s;
        }

        .company-card:last-child { border-bottom: none; }
        .company-card:hover { background: #FAFAFA; }

        .company-top {
            display: flex;
            gap: 1.25rem;
            align-items: flex-start;
        }

        .company-body { flex: 1; min-width: 0; }

        .company-name {
            font-size: 1rem;
            font-weight: 700;
            color: var(--slate);
            margin-bottom: 4px;
        }

        .company-meta {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            font-size: 0.78rem;
            color: var(--gray-3);
            margin-bottom: 0.875rem;
        }

        /* Intent Score Widget */
        .intent-box {
            text-align: center;
            min-width: 90px;
            background: var(--gray-5);
            border-radius: 10px;
            padding: 0.875rem 0.75rem;
            border: 1px solid var(--border);
            flex-shrink: 0;
        }

        .intent-number {
            font-size: 1.75rem;
            font-weight: 700;
            line-height: 1;
        }

        .intent-number.high   { color: var(--success); }
        .intent-number.medium { color: var(--warning); }
        .intent-number.low    { color: var(--gray-3); }

        .intent-label {
            font-size: 0.6rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--gray-3);
            margin-top: 2px;
        }

        .intent-bar {
            height: 4px;
            background: var(--border);
            border-radius: 2px;
            margin-top: 8px;
            overflow: hidden;
        }

        .intent-fill {
            height: 100%;
            border-radius: 2px;
            transition: width 0.6s ease;
        }

        .intent-fill.high   { background: var(--success); }
        .intent-fill.medium { background: var(--warning); }
        .intent-fill.low    { background: var(--gray-4); }

        /* AI Summary */
        .ai-summary {
            background: linear-gradient(135deg, #f5f3ff 0%, #ede9fe 100%);
            border-left: 3px solid var(--purple);
            border-radius: 8px;
            padding: 0.875rem 1rem;
            margin-bottom: 0.875rem;
        }

        .ai-summary-label {
            font-size: 0.65rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--purple);
            margin-bottom: 4px;
        }

        .ai-summary-text {
            font-size: 0.8rem;
            color: var(--gray-1);
            line-height: 1.6;
        }

        /* Recommendation */
        .ai-recommendation {
            font-size: 0.8rem;
            color: var(--gray-1);
            background: #f0fdf4;
            border-left: 3px solid var(--success);
            border-radius: 6px;
            padding: 0.625rem 0.875rem;
            margin-bottom: 0.875rem;
        }

        /* Signal Badges */
        .badge-row { display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 0.875rem; }

        .signal-badge {
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.68rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.04em;
        }

        .signal-badge.hiring       { background: #dbeafe; color: #1d4ed8; }
        .signal-badge.contract     { background: #fef9c3; color: #a16207; }
        .signal-badge.expansion    { background: #fee2e2; color: #b91c1c; }
        .signal-badge.tech_mention { background: #d1fae5; color: #065f46; }

        /* Signal List */
        .signals-list { border-top: 1px solid var(--border); padding-top: 0.875rem; }

        .signal-item {
            display: flex;
            gap: 0.875rem;
            padding: 0.75rem;
            background: var(--gray-5);
            border-radius: 8px;
            margin-bottom: 0.5rem;
            font-size: 0.8rem;
        }

        .signal-icon {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: grid;
            place-items: center;
            font-size: 0.875rem;
            flex-shrink: 0;
        }

        .signal-icon.hiring       { background: #dbeafe; }
        .signal-icon.contract     { background: #fef9c3; }
        .signal-icon.expansion    { background: #fee2e2; }
        .signal-icon.tech_mention { background: #d1fae5; }

        .signal-body { flex: 1; }
        .signal-desc { color: var(--slate); margin-bottom: 2px; }
        .signal-source { font-size: 0.72rem; color: var(--gray-3); }

        .signal-ai-insight {
            font-size: 0.75rem;
            color: var(--purple);
            font-style: italic;
            margin-top: 4px;
        }

        .confidence-col {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 4px;
            font-size: 0.72rem;
            color: var(--gray-3);
            flex-shrink: 0;
        }

        .conf-bar {
            width: 52px;
            height: 4px;
            background: var(--border);
            border-radius: 2px;
            overflow: hidden;
        }

        .conf-fill {
            height: 100%;
            background: var(--success);
            border-radius: 2px;
        }

        /* ‚îÄ‚îÄ STATES ‚îÄ‚îÄ */
        .loading-state, .empty-state {
            padding: 3rem;
            text-align: center;
            color: var(--gray-3);
        }

        .spinner {
            width: 36px;
            height: 36px;
            border: 3px solid var(--border);
            border-top-color: var(--red);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        /* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
        @media (max-width: 1024px) {
            .stats-row { grid-template-columns: repeat(2, 1fr); }
            .filters-grid { grid-template-columns: repeat(3, 1fr); }
            .insights-grid { grid-template-columns: 1fr; }
        }

        @media (max-width: 768px) {
            .stats-row { grid-template-columns: 1fr 1fr; }
            .filters-grid { grid-template-columns: 1fr 1fr; }
            .search-row { flex-direction: column; }
            .company-top { flex-direction: column-reverse; }
            .intent-box { width: 100%; }
            .nav { display: none; }
        }
    </style>
</head>
<body>

<header class="header">
    <div class="header-inner">
        <div class="logo">
            <div class="logo-mark">
                <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="3 17 9 11 13 15 22 6"/>
                    <polyline points="14 6 22 6 22 14"/>
                </svg>
            </div>
            <div class="logo-name">Altitude<span>AI</span></div>
            <div class="logo-pill">AI-Powered</div>
        </div>
        <nav class="nav">
            <a href="#">Dashboard</a>
            <a href="#">Companies</a>
            <a href="#">Signals</a>
            <a href="#">AI Insights</a>
        </nav>
    </div>
</header>

<main class="container">

    <!-- AI Search -->
    <div class="search-hero">
        <div class="search-hero-label">AI Natural Language Search ¬∑ Live</div>
        <div class="search-row">
            <input class="ai-input" id="ai-input" type="text"
                   placeholder="e.g. 'high intent manufacturing companies in Texas' or 'companies hiring network engineers'">
            <button class="ai-btn" onclick="runAISearch()">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                Search with AI
            </button>
        </div>
        <div class="search-hints">
            <span class="hint-chip" onclick="fillSearch('high intent companies in Michigan')">High intent ¬∑ Michigan</span>
            <span class="hint-chip" onclick="fillSearch('companies hiring network engineers')">Hiring signals</span>
            <span class="hint-chip" onclick="fillSearch('government contract manufacturing')">Gov contracts</span>
            <span class="hint-chip" onclick="fillSearch('expanding facilities Texas')">Facility expansion</span>
        </div>
    </div>

    <!-- AI Status Banner (shown during search) -->
    <div class="ai-status" id="ai-status">
        <div class="spinner" style="width:20px;height:20px;border-width:2px;flex-shrink:0;margin:0;"></div>
        <span id="ai-status-text">AI is processing your query‚Ä¶</span>
    </div>

    <!-- Stats -->
    <div class="stats-row">
        <div class="stat-card">
            <div class="stat-label">Total Companies</div>
            <div class="stat-value" id="stat-companies">‚Äî</div>
        </div>
        <div class="stat-card green">
            <div class="stat-label">Active Signals</div>
            <div class="stat-value" id="stat-signals">‚Äî</div>
        </div>
        <div class="stat-card purple">
            <div class="stat-label">Avg AI Intent Score</div>
            <div class="stat-value" id="stat-avg-intent">‚Äî</div>
        </div>
        <div class="stat-card amber">
            <div class="stat-label">High Intent (70+)</div>
            <div class="stat-value" id="stat-high-intent">‚Äî</div>
        </div>
    </div>

    <!-- AI Market Insights -->
    <div class="insights-section">
        <div class="section-header">
            <div class="section-title">AI Market Insights</div>
            <div class="section-badge badge-purple">Auto-Generated</div>
        </div>
        <div class="insights-grid" id="insights-grid">
            <div class="loading-state" style="grid-column:1/-1">
                <div class="spinner"></div>
                <p style="font-size:0.85rem">AI analysing market data‚Ä¶</p>
            </div>
        </div>
    </div>

    <!-- Filters -->
    <div class="filters-section">
        <div class="filters-grid">
            <div class="filter-group">
                <label class="filter-label">State</label>
                <select class="filter-select" id="f-state">
                    <option value="">All States</option>
                </select>
            </div>
            <div class="filter-group">
                <label class="filter-label">Industry</label>
                <select class="filter-select" id="f-industry">
                    <option value="">All Industries</option>
                </select>
            </div>
            <div class="filter-group">
                <label class="filter-label">Company Size</label>
                <select class="filter-select" id="f-size">
                    <option value="">All Sizes</option>
                    <option value="50-200">50‚Äì200</option>
                    <option value="200-500">200‚Äì500</option>
                    <option value="500-1000">500‚Äì1,000</option>
                    <option value="1000-5000">1,000‚Äì5,000</option>
                </select>
            </div>
            <div class="filter-group">
                <label class="filter-label">Min AI Intent Score</label>
                <select class="filter-select" id="f-intent">
                    <option value="">Any Score</option>
                    <option value="70">70+ (High)</option>
                    <option value="50">50+ (Medium)</option>
                    <option value="30">30+ (Low)</option>
                </select>
            </div>
            <div class="filter-group">
                <label class="filter-label">&nbsp;</label>
                <button class="filter-btn" onclick="applyFilters()">Apply Filters</button>
            </div>
        </div>
    </div>

    <!-- Results -->
    <div class="results-section">
        <div class="results-header">
            <div class="results-title">AI-Ranked Companies</div>
            <div class="results-meta" id="results-meta">Loading‚Ä¶</div>
        </div>
        <div id="company-list">
            <div class="loading-state">
                <div class="spinner"></div>
                <p style="font-size:0.85rem">AI ranking by buying intent‚Ä¶</p>
            </div>
        </div>
    </div>

</main>

<script>
const ICONS = {
    hiring: 'üë•',
    contract: 'üìÑ',
    expansion: 'üèóÔ∏è',
    tech_mention: 'üíª'
};

function intentClass(score) {
    if (score >= 70) return 'high';
    if (score >= 45) return 'medium';
    return 'low';
}

// ‚îÄ‚îÄ Stats ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadStats() {
    const res = await fetch('/api/stats');
    const d = await res.json();
    document.getElementById('stat-companies').textContent = d.total_companies;
    document.getElementById('stat-signals').textContent = d.total_signals;
    document.getElementById('stat-avg-intent').textContent = d.avg_buying_intent + '%';
    document.getElementById('stat-high-intent').textContent = d.high_intent_companies;
}

// ‚îÄ‚îÄ AI Insights ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadInsights() {
    const res = await fetch('/api/ai-insights');
    const insights = await res.json();
    const grid = document.getElementById('insights-grid');
    grid.innerHTML = insights.map(i => `
        <div class="insight-card">
            <div class="insight-type">${i.insight_type}</div>
            <div class="insight-title">${i.title}</div>
            <div class="insight-desc">${i.description}</div>
            <div class="insight-confidence">
                <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg>
                AI Confidence: ${Math.round(i.confidence * 100)}%
            </div>
        </div>
    `).join('');
}

// ‚îÄ‚îÄ Filters ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadFilters() {
    const [sr, ir] = await Promise.all([fetch('/api/states'), fetch('/api/industries')]);
    const states = await sr.json();
    const industries = await ir.json();
    const ss = document.getElementById('f-state');
    states.forEach(s => ss.add(new Option(s, s)));
    const is = document.getElementById('f-industry');
    industries.forEach(i => is.add(new Option(i, i)));
}

// ‚îÄ‚îÄ Companies ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadCompanies(params = {}) {
    document.getElementById('company-list').innerHTML = `
        <div class="loading-state">
            <div class="spinner"></div>
            <p style="font-size:0.85rem">AI ranking by buying intent‚Ä¶</p>
        </div>`;
    document.getElementById('results-meta').textContent = 'Loading‚Ä¶';

    const qs = new URLSearchParams(params);
    const res = await fetch('/api/companies?' + qs);
    const companies = await res.json();
    renderCompanies(companies);
}

function applyFilters() {
    const params = {};
    const state = document.getElementById('f-state').value;
    const industry = document.getElementById('f-industry').value;
    const size = document.getElementById('f-size').value;
    const intent = document.getElementById('f-intent').value;
    if (state) params.state = state;
    if (industry) params.industry = industry;
    if (size) params.size = size;
    if (intent) params.min_intent = intent;
    loadCompanies(params);
}

function renderCompanies(companies) {
    const list = document.getElementById('company-list');
    const meta = document.getElementById('results-meta');
    meta.textContent = `${companies.length} companies ¬∑ sorted by AI intent score`;

    if (!companies.length) {
        list.innerHTML = `<div class="empty-state">üîç No companies match these filters ‚Äî try adjusting criteria.</div>`;
        return;
    }

    list.innerHTML = companies.map(c => {
        const cls = intentClass(c.buying_intent_score);
        const badgesHTML = c.signals.map(s =>
            `<span class="signal-badge ${s.signal_type}">${s.signal_type.replace('_',' ')}</span>`
        ).join('');

        const signalsHTML = c.signals.map(s => `
            <div class="signal-item">
                <div class="signal-icon ${s.signal_type}">${ICONS[s.signal_type] || 'üìä'}</div>
                <div class="signal-body">
                    <div class="signal-desc">${s.description}</div>
                    <div class="signal-source">Source: ${s.source}</div>
                    <div class="signal-ai-insight">üí° AI: ${s.ai_extracted_insight}</div>
                </div>
                <div class="confidence-col">
                    <div class="conf-bar">
                        <div class="conf-fill" style="width:${Math.round(s.confidence_score * 100)}%"></div>
                    </div>
                    <span>${Math.round(s.confidence_score * 100)}%</span>
                </div>
            </div>
        `).join('');

        return `
        <div class="company-card">
            <div class="company-top">
                <div class="company-body">
                    <div class="company-name">${c.name}</div>
                    <div class="company-meta">
                        <span>üìç ${c.city}, ${c.state}</span>
                        <span>üè≠ ${c.industry}</span>
                        <span>üë• ${c.size} employees</span>
                        <span>üí∞ ${c.revenue}</span>
                    </div>

                    <div class="ai-summary">
                        <div class="ai-summary-label">ü§ñ AI Analysis</div>
                        <div class="ai-summary-text">${c.ai_summary}</div>
                    </div>

                    <div class="ai-recommendation">${c.recommended_action}</div>

                    <div class="badge-row">${badgesHTML}</div>

                    ${c.signals.length ? `<div class="signals-list">${signalsHTML}</div>` : ''}
                </div>

                <div class="intent-box">
                    <div class="intent-number ${cls}">${c.buying_intent_score}</div>
                    <div class="intent-label">AI Intent</div>
                    <div class="intent-bar">
                        <div class="intent-fill ${cls}" style="width:${c.buying_intent_score}%"></div>
                    </div>
                </div>
            </div>
        </div>`;
    }).join('');
}

// ‚îÄ‚îÄ AI Search ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function runAISearch() {
    const query = document.getElementById('ai-input').value.trim();
    if (!query) return;

    const statusEl = document.getElementById('ai-status');
    const statusText = document.getElementById('ai-status-text');
    statusEl.classList.add('visible');
    statusText.textContent = `AI processing: "${query}"‚Ä¶`;

    try {
        const res = await fetch('/api/search', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ query })
        });
        const data = await res.json();

        statusText.textContent = `‚úì ${data.ai_interpretation}`;
        setTimeout(() => statusEl.classList.remove('visible'), 4000);

        renderCompanies(data.results.map(r => r.company));
        document.getElementById('results-meta').textContent =
            `${data.total} results for AI search ¬∑ "${query}"`;
    } catch (err) {
        statusText.textContent = 'Search failed ‚Äî please try again.';
        setTimeout(() => statusEl.classList.remove('visible'), 3000);
    }
}

function fillSearch(text) {
    document.getElementById('ai-input').value = text;
    runAISearch();
}

document.getElementById('ai-input').addEventListener('keydown', e => {
    if (e.key === 'Enter') runAISearch();
});

// ‚îÄ‚îÄ Init ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
(async () => {
    await Promise.all([loadStats(), loadInsights(), loadFilters()]);
    loadCompanies();
})();
</script>
</body>
</html>
